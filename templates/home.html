{% include 'layout.html' %}

<div class="container mt-5">
  <h3>Add input to chat with personal chatbot</h3>

  <!-- Chat History Section -->
  <div class="card text-center mt-3">
    <div class="card-header">Chat History:</div>
    <div class="card-body chat-history" id="chatHistory">
      <!-- Messages will populate here -->
      {% for response in chat_responses %}
      <div class="{{ 'chat-message user-input' if loop.index0 is even else 'chat-message ai-response' }}">
        {{ response }}
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Input Section -->
  <div class="input-group mb-3" id="footer">
    <input class="form-control" placeholder="Add input here" id="userInput">
    <button class="btn btn-outline-primary" type="button" id="sendButton">Send</button>
  </div>
</div>


<script>

  var ws = new WebSocket(websocketString);
var chatHistory = document.getElementById("chatHistory");

ws.onmessage = function(event) {
    var message = event.data.trim();

    var messageDiv = document.createElement("div");
    messageDiv.className = "chat-message ai-response";
    messageDiv.textContent = message;
    chatHistory.appendChild(messageDiv);

    chatHistory.scrollTop = chatHistory.scrollHeight;  // Auto-scroll to the latest message
};

sendButton.onclick = function() {
    var message = userInput.value.trim();
    if (message) {
        var userInputDiv = document.createElement("div");
        userInputDiv.className = "chat-message user-input";
        userInputDiv.textContent = message;
        chatHistory.appendChild(userInputDiv);

        chatHistory.scrollTop = chatHistory.scrollHeight;  // Auto-scroll after user sends message

        ws.send(message);
        userInput.value = "";  // Clear input field
    }
};


</script>